# HeroDex 3000 - Online Screen (Search & Reconcile)
screen:
  type: Scaffold
  props:
    appBar:
      type: AppBar
      props:
        title:
          type: Text
          props:
            data: "Online"
            style:
              fontFamily: "Orbitron"

    body:
      type: Column
      props:
        crossAxisAlignment: "stretch"
        children:
          # Search Input
          - type: Padding
            props:
              padding: 16
              child:
                type: TextField
                props:
                  decoration:
                    hintText: "Enter hero or villain name..."
                    prefixIcon: "search"
                    border: "outline"
                  value: "shql: Search.search_query"
                  onChanged: "shql: Search.SET_SEARCH_QUERY(value)"
                  onSubmitted: "shql: Search.SEARCH_HEROES(value)"

          # Search History
          - type: Observer
            props:
              query: "Search.search_history"
              builder:
                type: Padding
                props:
                  padding:
                    left: 16
                    right: 16
                    bottom: 8
                  child:
                    type: Wrap
                    props:
                      spacing: 8
                      runSpacing: 4
                      children: "shql: Search.GENERATE_SEARCH_HISTORY()"

          # Loading Indicator
          - type: Observer
            props:
              query: "Search.is_loading"
              builder:
                type: "shql: IF Search.is_loading THEN 'LinearProgressIndicator' ELSE 'SizedBox'"
                props:
                  height: "shql: IF Search.is_loading THEN null ELSE 0"

          # Reconcile progress (shown during reconciliation)
          - type: Observer
            props:
              query: "Heroes.reconcile_active, Heroes.reconcile_current, Heroes.reconcile_status"
              builder:
                type: "shql: IF Heroes.reconcile_active THEN 'Padding' ELSE 'SizedBox'"
                props:
                  height: 0
                  padding:
                    left: 16
                    right: 16
                    bottom: 8
                  child:
                    type: Card
                    props:
                      child:
                        type: Padding
                        props:
                          padding: 12
                          child:
                            type: Row
                            props:
                              children:
                                - type: SizedBox
                                  props:
                                    width: 20
                                    height: 20
                                    child:
                                      type: CircularProgressIndicator
                                      props:
                                        strokeWidth: 2
                                - type: SizedBox
                                  props:
                                    width: 12
                                - type: Expanded
                                  child:
                                    type: Column
                                    props:
                                      crossAxisAlignment: "start"
                                      children:
                                        - type: Text
                                          props:
                                            data: "shql: 'Reconciling: ' + Heroes.reconcile_current"
                                            style:
                                              fontWeight: "bold"
                                              fontSize: 13
                                        - type: Text
                                          props:
                                            data: "shql: Heroes.reconcile_status"
                                            style:
                                              fontSize: 12
                                              color: "0xFF757575"
                                - type: SizedBox
                                  props:
                                    width: 8
                                - type: TextButton
                                  props:
                                    onPressed: "shql: Heroes.ABORT_RECONCILE()"
                                    child:
                                      type: Text
                                      props:
                                        data: "Abort"
                                        style:
                                          color: "0xFFE53935"

          # Search summary message (shown after dialog-based save flow)
          - type: Observer
            props:
              query: "Search.search_summary"
              builder:
                type: "shql: IF LENGTH(Search.search_summary) > 0 THEN 'Padding' ELSE 'SizedBox'"
                props:
                  height: 0
                  padding:
                    left: 16
                    right: 16
                    bottom: 8
                  child:
                    type: Card
                    props:
                      child:
                        type: Padding
                        props:
                          padding: 12
                          child:
                            type: Row
                            props:
                              children:
                                - type: Icon
                                  props:
                                    icon: "info"
                                    color: "0xFF1976D2"
                                    size: 20
                                - type: SizedBox
                                  props:
                                    width: 8
                                - type: Expanded
                                  child:
                                    type: Text
                                    props:
                                      data: "shql: Search.search_summary"
                                      style:
                                        fontSize: 13

          # Reconcile
          - type: Padding
            props:
              padding:
                left: 16
                right: 16
                bottom: 8
              child:
                type: OutlinedButton
                props:
                  onPressed: "shql: Heroes.RECONCILE_HEROES()"
                  child:
                    type: Row
                    props:
                      mainAxisAlignment: "center"
                      children:
                        - type: Icon
                          props:
                            icon: "sync"
                            size: 18
                        - type: SizedBox
                          props:
                            width: 8
                        - type: Text
                          props:
                            data: "Reconcile Saved Heroes"

          # Reconcile log (live during reconciliation) or empty state
          - type: Expanded
            child:
              type: Observer
              props:
                query: "Heroes.reconcile_log"
                builder:
                  type: "shql: IF LENGTH(Heroes.reconcile_log) > 0 THEN 'ListView' ELSE 'Center'"
                  props:
                    padding: 0
                    children: "shql: Heroes.reconcile_log"
                    child:
                      type: Column
                      props:
                        mainAxisSize: "min"
                        children:
                          - type: Icon
                            props:
                              icon: "search"
                              size: 64
                              color: "0xFF9E9E9E"
                          - type: SizedBox
                            props:
                              height: 16
                          - type: Text
                            props:
                              data: "Search for heroes and villains"
                              style:
                                fontSize: 18
                                color: "0xFF757575"
                          - type: SizedBox
                            props:
                              height: 8
                          - type: Text
                            props:
                              data: "Results will be shown one by one for review"
                              style:
                                color: "0xFF9E9E9E"

    bottomNavigationBar:
      type: BottomNav
      props:
        currentIndex: 1
        onTap: "Nav.TAB_NAV(1, value)"
